# SSAFY API 연동 가이드

## 📋 개요
Campus Credo 앱에서 SSAFY API를 사용하여 학생 이메일 검증 및 계정 생성을 위한 연동 가이드입니다.

## 🔑 핵심 기능

### 1. 이메일 중복 확인 (회원가입 시)
- **SSAFY API**: `MEMBER_02` (사용자 계정 조회)
- **목적**: 이미 SSAFY API에 등록된 이메일인지 확인
- **결과**:
  - ✅ **가입 가능**: SSAFY 학생이지만 아직 등록되지 않은 이메일
  - ✅ **가입 가능 (유연한 검증)**: 일반적인 이메일 도메인 사용자
  - ❌ **가입 불가**: 이미 SSAFY API에 등록된 이메일

### 2. 계정 생성 (신규 가입 시)
- **SSAFY API**: `MEMBER_01` (사용자 계정 생성)
- **목적**: SSAFY API에 새로운 계정 생성
- **결과**: SSAFY에서 `user_key` 발급

### 3. 앱 계정 연결
- **목적**: SSAFY API의 `user_key`와 앱의 비밀번호를 매핑
- **결과**: 하나의 이메일로 두 시스템 모두 사용 가능

### 4. 유연한 이메일 도메인 지원
- **지원 도메인**: gmail, naver, daum, kakao, ssafy.com, ac.kr, edu 등
- **목적**: 다양한 이메일을 사용하는 SSAFY 학생들을 위한 포용적 정책
- **방식**: API에서 확인되지 않아도 일반적인 도메인은 가입 허용

## 🔄 워크플로우

### 회원가입 프로세스
```
1. 사용자가 이메일 입력
2. "중복확인" 버튼 클릭
3. SSAFY API로 학생 정보 확인
   ├─ ✅ SSAFY 학생 + 미등록 → 가입 가능
   ├─ ✅ 일반적인 이메일 도메인 → 유연한 검증으로 가입 가능
   └─ ❌ SSAFY 학생 아님 또는 이미 등록 → 가입 불가
4. 가입 가능한 경우 회원가입 진행
5. SSAFY API에 계정 생성 (MEMBER_01)
6. 백엔드에 사용자 정보 + SSAFY user_key 저장
7. 회원가입 완료
```

### 로그인 프로세스
```
1. 사용자가 이메일 + 비밀번호 입력
2. 백엔드에서 사용자 정보 확인
3. SSAFY API user_key와 매핑된 계정인지 확인
4. 로그인 성공
```

## 🛠️ 구현된 기능

### Frontend (React Native)
- **SignupForm**: SSAFY 학생 이메일 검증 UI
- **중복확인 버튼**: 상태별 색상 및 메시지 표시
- **자동 정보 채우기**: SSAFY 학생 정보 자동 입력
- **단계별 검증**: 이메일 중복 확인 완료 후 다음 단계 진행

### Services
- **verifySSAFYEmail**: SSAFY 학생 이메일 검증
- **createSSAFYAccount**: SSAFY API 계정 생성
- **signUpWithEmail**: 통합 회원가입 (SSAFY + 백엔드)

### API Endpoints
- `POST /api/auth/verify-ssafy-email`: SSAFY 학생 이메일 검증
- `POST /api/auth/create-ssafy-account`: SSAFY API 계정 생성
- `POST /api/auth/signup`: 통합 회원가입

## 🎯 사용자 경험

### 성공 시나리오
1. **이메일 입력** → SSAFY 학생 이메일 입력
2. **중복확인** → "✅ SSAFY 학생 확인: 김SSAFY (SSAFY 대학교)" 표시
3. **정보 자동 채우기** → 이름, 대학교, 학번 자동 입력
4. **회원가입 진행** → 비밀번호 설정 및 개인정보 입력
5. **가입 완료** → "🎉 SSAFY 학생 계정이 성공적으로 생성되었습니다"

### 유연한 검증 시나리오
1. **이메일 입력** → gmail, naver 등 일반적인 이메일 입력
2. **중복확인** → "✅ 이메일 도메인 확인: gmail.com - 일반적인 이메일 서비스입니다"
3. **수동 정보 입력** → 개인정보를 직접 입력하여 가입 진행
4. **가입 완료** → "🎉 SSAFY 학생 계정이 성공적으로 생성되었습니다"

### 실패 시나리오
1. **이미 등록된 이메일** → "❌ 이미 SSAFY API에 등록된 이메일입니다. (이미 가입된 이메일)"
2. **지원하지 않는 도메인** → "❌ 지원하지 않는 이메일 도메인 - 일반적인 이메일 서비스를 사용하세요"
3. **API 오류** → 구체적인 오류 메시지와 해결 방법 안내

## 🔧 에러 코드별 처리

### SSAFY API 응답 코드
- **E4001**: 입력 형식 오류 → 사용자에게 형식 안내
- **E4002**: 이미 등록된 ID → 가입 불가 메시지
- **E4004**: API 키 오류 → 관리자 문의 안내
- **Q1001**: 요청 형식 오류 → 재시도 안내

### 네트워크 오류
- **타임아웃**: 15초 초과 시 재시도 안내
- **연결 실패**: 서버 상태 확인 안내
- **일반 오류**: 구체적인 오류 메시지 표시

## 📱 UI/UX 특징

### 중복확인 버튼 상태
- **기본**: 파란색 + "중복확인"
- **확인 중**: 회색 + "확인중..." + 로딩 스피너
- **가입 가능**: 초록색 + "확인완료" + 체크 아이콘
- **가입 불가**: 빨간색 + "사용불가" + X 아이콘

### 메시지 표시
- **성공**: 초록색 + 구체적인 학생 정보
- **실패**: 빨간색 + 오류 원인과 해결 방법
- **추가 안내**: 상태별 상세 설명

## 🚀 향후 개선 사항

### 1. 캐싱
- SSAFY 학생 정보 캐싱으로 중복 API 호출 방지
- 오프라인 상태에서도 기본 검증 가능

### 2. 자동 재시도
- 네트워크 오류 시 자동 재시도 로직
- 지수 백오프를 통한 스마트한 재시도

### 3. 실시간 검증
- 이메일 입력 중 실시간 SSAFY 학생 확인
- 타이핑 완료 후 자동 검증

### 4. 다국어 지원
- 한국어/영어 메시지 지원
- SSAFY API 응답 언어별 처리

## 📚 참고 자료

- [SSAFY API 연동 가이드](../SSAFY_API_INTEGRATION.md)
- [백엔드 API 문서](../../backend/README.md)
- [프론트엔드 컴포넌트 가이드](./components/README.md)

---

**📝 작성자**: AI Assistant  
**📅 작성일**: 2025-01-27  
**🔄 최종 업데이트**: 2025-01-27
